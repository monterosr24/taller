<div class="container">
    <div class="header">
        <h1>Trabajos</h1>
        <button mat-raised-button color="primary" (click)="createJob()">
            <mat-icon>add</mat-icon>
            Nuevo Trabajo
        </button>
    </div>

    <div *ngIf="loading" class="loading">
        <mat-spinner></mat-spinner>
    </div>

    <div class="table-container" *ngIf="!loading">
        <table mat-table [dataSource]="jobs" class="mat-elevation-z8">

            <!-- ID Column -->
            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef>ID</th>
                <td mat-cell *matCellDef="let job">{{ job.id }}</td>
            </ng-container>

            <!-- Vehicle Column -->
            <ng-container matColumnDef="vehicle">
                <th mat-header-cell *matHeaderCellDef>Vehículo</th>
                <td mat-cell *matCellDef="let job">
                    <div class="vehicle-info">
                        <mat-icon class="info-icon">directions_car</mat-icon>
                        {{ getVehicleInfo(job.vehicleId) }}
                    </div>
                </td>
            </ng-container>

            <!-- Worker Column -->
            <ng-container matColumnDef="worker">
                <th mat-header-cell *matHeaderCellDef>Trabajador</th>
                <td mat-cell *matCellDef="let job">
                    <div class="worker-info">
                        <mat-icon class="info-icon">person</mat-icon>
                        {{ getWorkerName(job.workerId) }}
                    </div>
                </td>
            </ng-container>

            <!-- Description Column -->
            <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef>Descripción</th>
                <td mat-cell *matCellDef="let job" class="description-cell">
                    {{ job.description }}
                </td>
            </ng-container>

            <!-- Total Amount Column -->
            <ng-container matColumnDef="totalAmount">
                <th mat-header-cell *matHeaderCellDef>Total</th>
                <td mat-cell *matCellDef="let job" class="amount">
                    {{ job.totalAmount | currency:'USD':'symbol':'1.2-2' }}
                </td>
            </ng-container>

            <!-- Advance Amount Column -->
            <ng-container matColumnDef="advanceAmount">
                <th mat-header-cell *matHeaderCellDef>Adelantos</th>
                <td mat-cell *matCellDef="let job" class="amount advance">
                    {{ job.advanceAmount || 0 | currency:'USD':'symbol':'1.2-2' }}
                </td>
            </ng-container>

            <!-- Balance Column -->
            <ng-container matColumnDef="balance">
                <th mat-header-cell *matHeaderCellDef>Saldo</th>
                <td mat-cell *matCellDef="let job" class="amount balance">
                    <strong>{{ getBalance(job) | currency:'USD':'symbol':'1.2-2' }}</strong>
                </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Estado</th>
                <td mat-cell *matCellDef="let job">
                    <span class="status-badge status-{{job.status}}">
                        {{ getStatusLabel(job.status) }}
                    </span>
                </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let job">
                    <button mat-icon-button [matMenuTriggerFor]="menu" color="primary">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu">
                        <button mat-menu-item (click)="editJob(job.id)">
                            <mat-icon>edit</mat-icon>
                            <span>Editar</span>
                        </button>
                        <button mat-menu-item (click)="addAdvance(job)"
                            [disabled]="job.status === 'completed' || job.status === 'cancelled'">
                            <mat-icon>payment</mat-icon>
                            <span>Agregar Adelanto</span>
                        </button>
                        <button mat-menu-item (click)="deleteJob(job.id)" class="delete-option">
                            <mat-icon>delete</mat-icon>
                            <span>Eliminar</span>
                        </button>
                    </mat-menu>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <!-- No data row -->
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" [attr.colspan]="displayedColumns.length">
                    <div class="no-data">
                        <mat-icon>work_off</mat-icon>
                        <p>No hay trabajos registrados</p>
                        <button mat-raised-button color="primary" (click)="createJob()">
                            Crear Primer Trabajo
                        </button>
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>